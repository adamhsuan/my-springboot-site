<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Derivative Calculator</title>
    <link rel="stylesheet" href="style.css">
    <!--./mvnw spring-boot:run and http://localhost:8080/-->
</head>

<body>
    <div class="container">
    <h1>Derivative Calculator</h1>
        <!-- Expression input large on top -->
        <label for="userInput">Enter expression:</label>
        <textarea class="growbox large-input" id="userInput" placeholder="e.g. 2*x^3" spellcheck="false"></textarea>

        <!-- Row of small inputs -->
        <div class="row-inputs">
            <div>
                <label for="variableInput">Variable:</label>
                <textarea id="variableInput" spellcheck="false">x</textarea>
            </div>
            <div>
                <label for="orderInput">Order (n):</label>
                <textarea id="orderInput" spellcheck="false">1</textarea>
            </div>
            <div>
                <label for="pointInput">Evaluate at:</label>
                <textarea id="pointInput" placeholder="e.g. 2" spellcheck="false"></textarea>
            </div>
        </div>

        <!-- Results stacked -->
        <label for="resultBox">Derivative:</label>
        <textarea class="growbox" id="resultBox" readonly spellcheck="false"></textarea>

        <label for="valueBox">Value at point:</label>
        <textarea class="growbox" id="valueBox" readonly spellcheck="false"></textarea>
    </div>

    <div class="container description">
        This is a symbolic derivative calculator, a calculator that takes algebraic expressions and returns their derivatives. 
        <br><br>
        How to use it: Enter an expression such as 3sinx+e^y, a variable to differentiate with respect to (other variables are treated as constants), and an order. The order is the number of times you take the derivative. You may optionally enter a numerical value to evaluate the result of the derivative at.
        <br><br>
        How to enter a valid expression: The acceptable symbols and functions are digits,*,/,+,-,^,(,),|,sqrt,ln,sin,cos,tan,cot,sec,csc,arcsin,arccos,arctan,arccot,arcsec,arccsc. Fuctions and exponents may or may not have parenthesis, however if you don't include parenthesis only the next factor will be made an argument. For example, sinx and sin(x) are both allowable, however sinxy is the same as sin(x)*y and not sin(xy). Generally. the rules you would follow when entering a function into a graphing calculator apply to this calculator (for example, 1/xy = y/x not 1/(xy)).   
        <br><br>
        How it works: The program makes use of a tree data structure containing nodes corresponding to expressions, terms, factors, and exponents, and the majority of the program's complexity has to do with simplifying that tree. For a visual presentation of how it works, see: <a href="https://docs.google.com/presentation/d/14XaiFJIbZxPJq2-HeSK_Dl1nfehQIuyWaqItdpnzXF8/edit?slide=id.g35e44900450_0_360#slide=id.g35e44900450_0_360" target="_blank"> Derivative Calculator Explaination </a>. To view the full derivative calculator code (with comments), see: <a href="https://github.com/adamhsuan/symbolic-derivative-calculator" target="_blank"> Derivative Calculator GitHub Repository</a>.
    </div>


    <script>
        const inputBox = document.getElementById('userInput');
        const variableBox = document.getElementById('variableInput');
        const orderBox = document.getElementById('orderInput');
        const pointBox = document.getElementById('pointInput');
        const resultBox = document.getElementById('resultBox');
        const valueBox = document.getElementById('valueBox');

        function submitDerivative() {
            const input = inputBox.value;
            const variable = variableBox.value || "x";
            const order = orderBox.value || "1";
            const point = pointBox.value; // optional

            fetch(`/api/process?input=${encodeURIComponent(input)}&variable=${encodeURIComponent(variable)}&order=${encodeURIComponent(order)}&point=${encodeURIComponent(point)}`)
                .then(response => response.json()) // backend should return JSON now
                .then(data => {
                    resultBox.value = data.derivative || "";
                    autoGrow(resultBox);

                    if (data.valueAtPoint !== undefined && data.valueAtPoint !== null) {
                        valueBox.value = data.valueAtPoint;
                        autoGrow(valueBox);
                    } else {
                        valueBox.value = ""; // clear if no point provided
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // Add Enter key listener to all boxes
        [inputBox, variableBox, orderBox, pointBox].forEach(box => {
            box.addEventListener('keypress', event => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    submitDerivative();
                }
            });
        });

        function autoGrow(element) {
            element.style.height = "auto";
            element.style.height = element.scrollHeight + "px";
        }

        // Apply auto-grow to textareas
        document.querySelectorAll('textarea').forEach(el => {
            el.addEventListener('input', () => autoGrow(el));
            autoGrow(el); // initialize
        });
    </script>
</body>
</html>
